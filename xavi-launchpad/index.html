<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XaviLaunchpad â€” One-Click AI Agent Deployment</title>
    <link rel="icon" type="image/png" href="../xavi-logo.png">
    <link rel="stylesheet" href="../xavi-design-system.css">
    <link rel="stylesheet" href="../xavi-animations.css">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ethers@6.7.0/dist/ethers.umd.min.js"></script>
    
    <style>
        .page-header {
            padding: 100px 0 40px;
            text-align: center;
        }
        
        .page-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-bottom: var(--space-md);
        }
        
        .page-desc {
            font-size: 17px;
            color: var(--xavi-muted);
            max-width: 560px;
            margin: var(--space-md) auto 0;
        }
        
        .contract-bar {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-lg);
            margin-top: var(--space-lg);
            flex-wrap: wrap;
        }
        
        .launch-container {
            max-width: 560px;
            margin: 0 auto;
        }
        
        .launch-card {
            padding: var(--space-xl);
        }
        
        .card-title {
            font-family: var(--font-display);
            font-size: 22px;
            font-weight: 600;
            margin-bottom: var(--space-lg);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }
        
        .form-group {
            margin-bottom: var(--space-lg);
        }
        
        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: var(--xavi-muted);
            margin-bottom: var(--space-sm);
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            background: var(--xavi-charcoal);
            border: 2px solid var(--xavi-border);
            border-radius: var(--radius-md);
            color: var(--xavi-white);
            font-size: 16px;
            transition: border-color var(--transition-fast);
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--xavi-purple-mid);
        }
        
        textarea.form-input {
            min-height: 80px;
            resize: vertical;
        }
        
        .form-hint {
            font-size: 13px;
            color: var(--xavi-dim);
            margin-top: 6px;
        }
        
        /* Tier Selector */
        .tier-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-md);
            margin-bottom: var(--space-lg);
        }
        
        .tier-option {
            padding: var(--space-lg);
            background: var(--xavi-charcoal);
            border: 2px solid var(--xavi-border);
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: all var(--transition-fast);
            text-align: center;
        }
        
        .tier-option:hover {
            border-color: var(--xavi-purple-mid);
        }
        
        .tier-option.active {
            border-color: var(--xavi-gold);
            background: rgba(212, 160, 57, 0.05);
        }
        
        .tier-option.premium.active {
            border-color: var(--xavi-purple-light);
            background: rgba(155, 77, 202, 0.05);
        }
        
        .tier-name {
            font-family: var(--font-display);
            font-size: 18px;
            font-weight: 600;
            margin-bottom: var(--space-sm);
        }
        
        .tier-price {
            font-size: 24px;
            font-weight: 700;
            color: var(--xavi-gold);
            margin-bottom: var(--space-sm);
        }
        
        .tier-option.premium .tier-price {
            color: var(--xavi-purple-light);
        }
        
        .tier-features {
            font-size: 13px;
            color: var(--xavi-muted);
            text-align: left;
        }
        
        .tier-features li {
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .tier-features li::before {
            content: 'âœ“';
            color: var(--xavi-success);
            font-weight: bold;
        }
        
        /* Capabilities Chips */
        .caps-container {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-sm);
        }
        
        .cap-chip {
            padding: 8px 14px;
            background: var(--xavi-surface);
            border: 1px solid var(--xavi-border);
            border-radius: var(--radius-full);
            font-size: 13px;
            color: var(--xavi-muted);
            cursor: pointer;
            transition: all var(--transition-fast);
        }
        
        .cap-chip:hover {
            border-color: var(--xavi-purple-mid);
        }
        
        .cap-chip.selected {
            background: var(--xavi-purple-deep);
            border-color: var(--xavi-purple-mid);
            color: var(--xavi-white);
        }
        
        /* Success Screen */
        .success-screen {
            display: none;
            text-align: center;
            padding: var(--space-2xl);
        }
        
        .success-screen.show {
            display: block;
        }
        
        .success-icon {
            width: 80px;
            height: 80px;
            background: var(--xavi-success-glow);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto var(--space-lg);
        }
        
        .success-icon svg {
            width: 40px;
            height: 40px;
            stroke: var(--xavi-success);
        }
        
        .success-title {
            font-family: var(--font-display);
            font-size: 28px;
            font-weight: 700;
            margin-bottom: var(--space-md);
        }
        
        .success-details {
            text-align: left;
            margin-top: var(--space-xl);
        }
        
        .success-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-md);
            background: var(--xavi-charcoal);
            border-radius: var(--radius-md);
            margin-bottom: var(--space-sm);
        }
        
        .success-item-label {
            font-size: 14px;
            color: var(--xavi-muted);
        }
        
        .success-item-value {
            font-family: var(--font-mono);
            font-size: 13px;
            color: var(--xavi-white);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }
        
        /* Launched Agents Gallery */
        .gallery-section {
            margin-top: var(--space-3xl);
        }
        
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: var(--space-lg);
        }
        
        .agent-card {
            padding: var(--space-lg);
        }
        
        .agent-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--space-md);
        }
        
        .agent-avatar {
            width: 48px;
            height: 48px;
            background: var(--xavi-purple-deep);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        
        .agent-tier {
            font-size: 11px;
            padding: 4px 8px;
            border-radius: var(--radius-full);
            text-transform: uppercase;
            font-weight: 600;
        }
        
        .agent-tier.standard {
            background: rgba(212, 160, 57, 0.15);
            color: var(--xavi-gold);
        }
        
        .agent-tier.premium {
            background: rgba(155, 77, 202, 0.15);
            color: var(--xavi-purple-light);
        }
        
        .agent-name {
            font-family: var(--font-display);
            font-size: 18px;
            font-weight: 600;
            margin-bottom: var(--space-xs);
        }
        
        .agent-domain {
            font-size: 13px;
            color: var(--xavi-dim);
            margin-bottom: var(--space-sm);
        }
        
        .agent-wallet {
            font-family: var(--font-mono);
            font-size: 12px;
            color: var(--xavi-muted);
            padding: 8px;
            background: var(--xavi-surface);
            border-radius: var(--radius-sm);
        }
        
        /* Stats */
        .launch-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--space-md);
            margin-top: var(--space-2xl);
        }
        
        .launch-stat {
            text-align: center;
            padding: var(--space-lg);
        }
        
        .launch-stat-value {
            font-family: var(--font-display);
            font-size: 28px;
            font-weight: 700;
            color: var(--xavi-white);
        }
        
        .launch-stat-label {
            font-size: 13px;
            color: var(--xavi-dim);
            margin-top: 4px;
        }
        
        @media (max-width: 768px) {
            .tier-selector {
                grid-template-columns: 1fr;
            }
            
            .launch-stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="xavi-bg"></div>
    <div class="xavi-bg-gradient"></div>
    <div class="ambient-orb ambient-orb-1"></div>
    <div class="ambient-orb ambient-orb-2"></div>
    
    <!-- Navbar -->
    <nav class="navbar">
        <div class="navbar-inner">
            <a href="../" class="navbar-logo">
                <i data-lucide="arrow-left" style="width: 20px; height: 20px; stroke: var(--xavi-muted);"></i>
                <img src="../xavi-logo.png" alt="Xavi">
                <span>XAVI</span>
            </a>
            <button class="btn btn-primary btn-sm" id="connectBtn" onclick="connectWallet()">
                <i data-lucide="wallet"></i>
                Connect
            </button>
        </div>
    </nav>
    
    <!-- Header -->
    <section class="page-header">
        <div class="container">
            <div class="page-badge">
                <div class="icon-box icon-box-sm">
                    <i data-lucide="rocket"></i>
                </div>
                <span class="badge badge-featured">New</span>
            </div>
            <h1>XaviLaunchpad</h1>
            <p class="page-desc">Launch your AI agent on XRPL EVM in one click. Deploy wallet, identity, and security audit in a single transaction.</p>
            <div class="contract-bar">
                <div class="pill">
                    <span>0x8A0f...7a542</span>
                    <i data-lucide="copy" style="width: 14px; cursor: pointer;" onclick="copyText('0x8A0f3dB41731195E8C60A88d0972450948F7a542')"></i>
                </div>
                <a href="https://explorer.xrplevm.org/address/0x8A0f3dB41731195E8C60A88d0972450948F7a542" target="_blank" class="btn btn-ghost btn-sm">
                    <i data-lucide="external-link"></i>
                    Explorer
                </a>
            </div>
        </div>
    </section>
    
    <!-- Launch Form -->
    <section class="section" style="padding-top: 0;">
        <div class="container">
            <div class="launch-container">
                <div class="xavi-card launch-card" id="launchForm">
                    <h3 class="card-title">
                        <i data-lucide="sparkles" style="width: 22px; stroke: var(--xavi-gold);"></i>
                        Launch Your AI Agent
                    </h3>
                    
                    <!-- Tier Selector -->
                    <div class="tier-selector">
                        <div class="tier-option active" onclick="selectTier('standard')">
                            <div class="tier-name">Standard</div>
                            <div class="tier-price">25 XRP</div>
                            <ul class="tier-features">
                                <li>XaviWallet deployment</li>
                                <li>ERC-8004 identity NFT</li>
                                <li>Sentinel security audit</li>
                                <li>10 XRP per-tx limit</li>
                            </ul>
                        </div>
                        <div class="tier-option premium" onclick="selectTier('premium')">
                            <div class="tier-name">Premium</div>
                            <div class="tier-price">50 XRP</div>
                            <ul class="tier-features">
                                <li>Everything in Standard</li>
                                <li>50 XRP per-tx limit</li>
                                <li>200 XRP daily limit</li>
                                <li>Priority audit queue</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Agent Name</label>
                        <input type="text" class="form-input" id="agentName" placeholder="MyAgent" maxlength="100">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Agent Wallet Address (Hot Key)</label>
                        <input type="text" class="form-input" id="agentAddress" placeholder="0x...">
                        <div class="form-hint">The operational address your agent will use</div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Description</label>
                        <textarea class="form-input" id="agentDesc" placeholder="What does your agent do?" maxlength="500"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Domain</label>
                        <input type="text" class="form-input" id="agentDomain" placeholder="trading.agent" maxlength="100">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Capabilities</label>
                        <div class="caps-container">
                            <span class="cap-chip" onclick="toggleCap(this)">Trading</span>
                            <span class="cap-chip" onclick="toggleCap(this)">Analysis</span>
                            <span class="cap-chip" onclick="toggleCap(this)">Research</span>
                            <span class="cap-chip" onclick="toggleCap(this)">Automation</span>
                            <span class="cap-chip" onclick="toggleCap(this)">Monitoring</span>
                            <span class="cap-chip" onclick="toggleCap(this)">DeFi</span>
                            <span class="cap-chip" onclick="toggleCap(this)">NFT</span>
                            <span class="cap-chip" onclick="toggleCap(this)">Social</span>
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" style="width: 100%;" id="launchBtn" onclick="launchAgent()">
                        <i data-lucide="rocket"></i>
                        Launch Agent
                    </button>
                </div>
                
                <!-- Success Screen -->
                <div class="xavi-card success-screen" id="successScreen">
                    <div class="success-icon">
                        <i data-lucide="check"></i>
                    </div>
                    <h2 class="success-title">Agent Launched! ðŸš€</h2>
                    <p class="text-muted">Your AI agent is now live on XRPL EVM</p>
                    
                    <div class="success-details">
                        <div class="success-item">
                            <span class="success-item-label">XaviWallet</span>
                            <span class="success-item-value" id="successWallet">
                                <span>0x...</span>
                                <a href="#" target="_blank" id="walletLink"><i data-lucide="external-link" style="width: 14px;"></i></a>
                            </span>
                        </div>
                        <div class="success-item">
                            <span class="success-item-label">ERC-8004 Identity</span>
                            <span class="success-item-value" id="successIdentity">#1</span>
                        </div>
                        <div class="success-item">
                            <span class="success-item-label">Sentinel Audit</span>
                            <span class="success-item-value">
                                <span class="badge badge-building">Pending</span>
                            </span>
                        </div>
                    </div>
                    
                    <button class="btn btn-secondary mt-lg" style="width: 100%;" onclick="resetForm()">
                        Launch Another Agent
                    </button>
                </div>
            </div>
            
            <!-- Stats -->
            <div class="launch-stats">
                <div class="xavi-card-flat launch-stat">
                    <div class="launch-stat-value" id="totalLaunches">0</div>
                    <div class="launch-stat-label">Agents Launched</div>
                </div>
                <div class="xavi-card-flat launch-stat">
                    <div class="launch-stat-value">25 XRP</div>
                    <div class="launch-stat-label">Starting From</div>
                </div>
                <div class="xavi-card-flat launch-stat">
                    <div class="launch-stat-value">3</div>
                    <div class="launch-stat-label">Contracts Deployed</div>
                </div>
            </div>
            
            <!-- Gallery -->
            <div class="gallery-section">
                <h2 class="section-title-animated mb-lg">Recently Launched Agents</h2>
                <div class="gallery-grid" id="agentGallery">
                    <!-- Populated by JS -->
                </div>
            </div>
        </div>
    </section>
    
    <!-- Toast -->
    <div class="toast" id="toast">
        <i data-lucide="check-circle"></i>
        <span id="toastMsg">Success!</span>
    </div>

    <script>
        lucide.createIcons();
        
        const LAUNCHPAD = '0x8A0f3dB41731195E8C60A88d0972450948F7a542';
        const BASE_FEE = '25';
        const PREMIUM_FEE = '50';
        
        const LAUNCHPAD_ABI = [
            "function launchAgent(address agentAddress, string name, string description, string[] capabilities, string domain) external payable returns (address wallet, uint256 agentId, uint256 auditRequestId)",
            "function totalLaunchCount() external view returns (uint256)",
            "function getAllLaunches() external view returns (tuple(uint256 id, address owner, address agentAddress, address walletAddress, uint256 agentId, uint256 auditRequestId, uint256 timestamp, bool premiumTier)[])",
            "function baseFee() external view returns (uint256)",
            "function premiumFee() external view returns (uint256)"
        ];
        
        let provider, signer, userAddress, contract;
        let selectedTier = 'standard';
        let selectedCaps = [];
        
        async function connectWallet() {
            if (!window.ethereum) {
                showToast('Please install MetaMask', 'error');
                return;
            }
            try {
                await window.ethereum.request({ method: 'eth_requestAccounts' });
                provider = new ethers.BrowserProvider(window.ethereum);
                signer = await provider.getSigner();
                userAddress = await signer.getAddress();
                contract = new ethers.Contract(LAUNCHPAD, LAUNCHPAD_ABI, signer);
                
                document.getElementById('connectBtn').innerHTML = `<i data-lucide="wallet"></i>${userAddress.slice(0,6)}...${userAddress.slice(-4)}`;
                lucide.createIcons();
                
                loadStats();
                loadGallery();
                showToast('Wallet connected!');
            } catch (e) {
                showToast(e.message, 'error');
            }
        }
        
        function selectTier(tier) {
            selectedTier = tier;
            document.querySelectorAll('.tier-option').forEach(el => el.classList.remove('active'));
            document.querySelector(`.tier-option${tier === 'premium' ? '.premium' : ':not(.premium)'}`).classList.add('active');
        }
        
        function toggleCap(el) {
            el.classList.toggle('selected');
            const cap = el.textContent;
            if (el.classList.contains('selected')) {
                selectedCaps.push(cap);
            } else {
                selectedCaps = selectedCaps.filter(c => c !== cap);
            }
        }
        
        async function launchAgent() {
            if (!userAddress) {
                connectWallet();
                return;
            }
            
            const name = document.getElementById('agentName').value.trim();
            const address = document.getElementById('agentAddress').value.trim();
            const desc = document.getElementById('agentDesc').value.trim();
            const domain = document.getElementById('agentDomain').value.trim();
            
            if (!name || !address || !domain) {
                showToast('Please fill in all required fields', 'error');
                return;
            }
            
            if (!ethers.isAddress(address)) {
                showToast('Invalid agent wallet address', 'error');
                return;
            }
            
            const fee = selectedTier === 'premium' ? PREMIUM_FEE : BASE_FEE;
            
            try {
                document.getElementById('launchBtn').innerHTML = '<span class="spinner"></span> Launching...';
                document.getElementById('launchBtn').disabled = true;
                
                const tx = await contract.launchAgent(
                    address,
                    name,
                    desc,
                    selectedCaps,
                    domain,
                    { value: ethers.parseEther(fee) }
                );
                
                showToast('Transaction submitted! Waiting for confirmation...');
                const receipt = await tx.wait();
                
                // Parse event for wallet address and agent ID
                // For now, show success
                showSuccess(address);
                
            } catch (e) {
                console.error(e);
                showToast(e.reason || e.message, 'error');
            } finally {
                document.getElementById('launchBtn').innerHTML = '<i data-lucide="rocket"></i> Launch Agent';
                document.getElementById('launchBtn').disabled = false;
                lucide.createIcons();
            }
        }
        
        function showSuccess(wallet) {
            document.getElementById('launchForm').style.display = 'none';
            document.getElementById('successScreen').classList.add('show');
            document.getElementById('successWallet').querySelector('span').textContent = wallet.slice(0,8) + '...' + wallet.slice(-6);
            document.getElementById('walletLink').href = `https://explorer.xrplevm.org/address/${wallet}`;
            lucide.createIcons();
            loadStats();
            loadGallery();
        }
        
        function resetForm() {
            document.getElementById('launchForm').style.display = 'block';
            document.getElementById('successScreen').classList.remove('show');
            document.getElementById('agentName').value = '';
            document.getElementById('agentAddress').value = '';
            document.getElementById('agentDesc').value = '';
            document.getElementById('agentDomain').value = '';
            selectedCaps = [];
            document.querySelectorAll('.cap-chip').forEach(el => el.classList.remove('selected'));
        }
        
        async function loadStats() {
            if (!contract) return;
            try {
                const count = await contract.totalLaunchCount();
                document.getElementById('totalLaunches').textContent = count.toString();
            } catch (e) {
                console.error(e);
            }
        }
        
        async function loadGallery() {
            if (!contract) return;
            try {
                const launches = await contract.getAllLaunches();
                const gallery = document.getElementById('agentGallery');
                
                if (launches.length === 0) {
                    gallery.innerHTML = '<p class="text-muted text-center">No agents launched yet. Be the first!</p>';
                    return;
                }
                
                gallery.innerHTML = launches.slice(-6).reverse().map(l => `
                    <div class="xavi-card agent-card">
                        <div class="agent-card-header">
                            <div class="agent-avatar">ðŸ¤–</div>
                            <span class="agent-tier ${l.premiumTier ? 'premium' : 'standard'}">${l.premiumTier ? 'Premium' : 'Standard'}</span>
                        </div>
                        <div class="agent-name">Agent #${l.agentId.toString()}</div>
                        <div class="agent-domain">Launched ${new Date(Number(l.timestamp) * 1000).toLocaleDateString()}</div>
                        <div class="agent-wallet">${l.walletAddress.slice(0,10)}...${l.walletAddress.slice(-8)}</div>
                    </div>
                `).join('');
            } catch (e) {
                console.error(e);
            }
        }
        
        function copyText(text) {
            navigator.clipboard.writeText(text);
            showToast('Copied!');
        }
        
        function showToast(msg, type = 'success') {
            const toast = document.getElementById('toast');
            document.getElementById('toastMsg').textContent = msg;
            toast.className = `toast ${type} show`;
            setTimeout(() => toast.classList.remove('show'), 3000);
        }
        
        // Auto-connect if already connected
        if (window.ethereum?.selectedAddress) {
            connectWallet();
        }
    </script>
</body>
</html>
